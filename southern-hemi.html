<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Stab in the Dark 2017 | Contest Results</title>
  <meta name="author" content="Stab Magazine">
  <meta name="description" content="Stab in the Dark 2017 Contest">
  <meta name="keywords" content="stabmag, stab, magazine, surfing, surfboards, jordy, smith">
  <!-- <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon"> -->
  <link href="static/css/style.css" type="text/css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=PT+Serif|Roboto:500,700" rel="stylesheet">
  <script src="https://use.fontawesome.com/9aa665cf7f.js"></script>
  </head>
  <body>


  <div class="page" data-email="">


    <div class="navigation">
      <div class="navigation__left">
        <div class="logo-bg"><img src="/static/img/StabLogoWhite.png" /></div>
        <div class="site-title">STAB IN THE DARK 2017</div>
      </div>
      <div class="navigation__right">
        <a href="/"><div class="site-title" style="opacity:0.3">NORTHERN</div></a>
        <a href="/southern-hemi"><div class="site-title">SOUTHERN</div></a>
        <!-- <a href="/shared-list"><div class="site-title" style="opacity:0.3">SOCIAL SHARING</div></a> -->
      </div>
      <div id="mobile-nav" class="mobile-nav"><i class="fa fa-bars"></i></div>
      <div id="mobile-menu" class="mobile-menu d-none">
        <a href="/"><div class="site-title" style="opacity:0.3">NORTHERN</div></a>
        <a href="/southern-hemi"><div class="site-title" >SOUTHERN</div></a>
        <!-- <a href="/shared-list"><div class="site-title" style="opacity:0.3">SOCIAL SHARING</div></a> -->
      </div>
    </div>

    <div id="shaper" class="container d-none">

      <div class="shaper-header" style="padding-bottom:12px;">
        <div>
          <div id="shaperName" class="page-title"></div>
          <div class="back-button"><i class="fa fa-long-arrow-left"></i> <span>BACK TO SHAPERS</span></div>
        </div>
        <div id="shaperCount" class="page-title"></div>
      </div>

    <div id="shaper-entries" class="shaper-entries"></div>
    <div class="add-to-list">
      <div style="width:75%">
      <input id="list_email" placeholder="Email" type="text" />
      <input id="list_social" placeholder="Social Handle" type="text" />
      </div>
      <a id="list_add" href="#">Add To List</a>
    </div>

    <div class="button-container">
      <button id="btnDrawWinner">Draw Winner</button>
      <div id="winnerEmail" class="winner"></div>
    </div>



    </div>

    <div id="shapers" class="container">

      <div class="page-title">Southern Hemisphere</div>
      <div class="page-subtitle" >Select a shaper to view reader selection list, and draw a random winner.</div>

      <div class="results">

        <div class="result">
          <div data-name="Matt Biolos" class="result__name">Matt "Mayhem" Biolos</div>
          <div class="result__line"></div>
          <div id="MattBiolos" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Rusty Preisendorfer" class="result__name">Rusty Preisendorfer</div>
          <div class="result__line"></div>
          <div id="Rusty" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Jason Stevenson" class="result__name">Jason Stevenson</div>
          <div class="result__line"></div>
          <div id="JasonStevenson" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Graham Smith" class="result__name">Graham Smith</div>
          <div class="result__line"></div>
          <div id="GrahamSmith" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Darren Handley" class="result__name">Darren Handley</div>
          <div class="result__line"></div>
          <div id="DarrenHandley" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Lee Stacey" class="result__name">Lee Stacey</div>
          <div class="result__line"></div>
          <div id="LeeStacey" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Jon Pyzel" class="result__name">Jon Pyzel</div>
          <div class="result__line"></div>
          <div id="JonPyzel" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Hayden Cox" class="result__name">Hayden Cox</div>
          <div class="result__line"></div>
          <div id="HaydenCox" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Christiaan Bradley" class="result__name">Christiaan Bradley</div>
          <div class="result__line"></div>
          <div id="ChristiaanBradley" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="James Cheal" class="result__name">James Cheal</div>
          <div class="result__line"></div>
          <div id="JamesCheal" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="JohnnyC" class="result__name">Johnny Cabianca</div>
          <div class="result__line"></div>
          <div id="JohnnyCabianca" class="result__count"></div>
        </div>

        <div class="result">
          <div data-name="Simon Anderson" class="result__name">Simon Anderson</div>
          <div class="result__line"></div>
          <div id="SimonAnderson" class="result__count"></div>
        </div>

      </div>

    </div>


  </div> <!-- end page -->

  <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.4/lodash.min.js"></script>
  <script>
window.addEventListener("load", function(event) {
  // TODO: On page load.. get all the current poll results, and bind changes.

  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyClVUDaals4XX2qCox561okBfZRXDNUZ4o",
    authDomain: "stabinthedark2017.firebaseapp.com",
    databaseURL: "https://stabinthedark2017.firebaseio.com",
    projectId: "stabinthedark2017",
    storageBucket: "stabinthedark2017.appspot.com",
    messagingSenderId: "687257526210"
  };
  firebase.initializeApp(config);

  document.getElementById("mobile-nav").onclick = function() {
    if ( document.getElementById("mobile-menu").classList.contains("d-none") ) {
      document.getElementById("mobile-menu").classList.remove("d-none");
    } else {
        document.getElementById("mobile-menu").classList.add("d-none");
    }
  }

  document.getElementById("list_add").onclick = function(e) {

    var email = document.getElementById("list_email").value;
    var social = document.getElementById("list_social").value;
    var timeStamp = Date.now();

    var shaper = document.getElementById("shaperName").innerHTML


    if (shaper === "Johnny Cabianca") {
      shaper = "JohnnyC";
    }

    console.log(email,social,timeStamp)

    firebase.database().ref("southern-hemisphere-responses/"+ shaper + "/" + timeStamp).set({email: email, social: social});

    document.getElementById("list_email").value = ""
    document.getElementById("list_social").value = ""


  }


  document.getElementById("btnDrawWinner").onclick = function() {
    // get our current list....
    var shaperName = document.getElementById("shaperName").innerHTML;
    console.log()
    if (shaperName === "Johnny Cabianca") {
      shaperName = "JohnnyC";
    }

    document.getElementById("winnerEmail").innerHTML = '...';


    firebase.database().ref('southern-hemisphere-responses/' + shaperName).once('value').then(function(snapshot) {
      var entries = snapshot.val();
      var random = _.sample(entries);
      document.getElementById("winnerEmail").innerHTML = random.email;
    });


  }

  var shaper = document.getElementsByClassName("result__name");

  Array.from(shaper).forEach(function(element) {
    element.addEventListener("click", handleShaperClick);
  });

  function handleShaperClick() {

    document.getElementById("winnerEmail").innerHTML = '';
    var shaperName = this.getAttribute("data-name");

    if (shaperName === "JohnnyC") {
      document.getElementById("shaperName").innerHTML = "Johnny Cabianca";
    } else {
      document.getElementById("shaperName").innerHTML = shaperName;
    }

    var shaperEmailsRef = firebase.database().ref("southern-hemisphere-responses/" + shaperName);
    shaperEmailsRef.on("value", function(snapshot) {
      document.getElementById("shaperCount").innerHTML = _.size(snapshot.val());
      var shaperEntries = document.getElementById("shaper-entries");
      shaperEntries.innerHTML = "";

      _.forEach(snapshot.val(), function(value) {
        console.log(value.email);

        var markup = `<div class="shaper-entry shaper-entry--list"> <div class="email-entry">${value.email}</div><div class="email-entry">${value.social}</div></div>`;
        shaperEntries.innerHTML += markup;
      });
    });

    document.getElementById("shaper").classList.remove("d-none");
    document.getElementById("shapers").classList.add("d-none");
  }

  getCurrentPollData();
  function getCurrentPollData() {
    var mattBiolosRef = firebase.database().ref("southern-hemisphere-responses/Matt Biolos");
    mattBiolosRef.on("value", function(snapshot) {
      var mattBiolosCount = _.size(snapshot.val());
      document.getElementById("MattBiolos").innerHTML = mattBiolosCount;
    });

    var rustyRef = firebase.database().ref("southern-hemisphere-responses/Rusty Preisendorfer");
    rustyRef.on("value", function(snapshot) {
      var rustyCount = _.size(snapshot.val());
      document.getElementById("Rusty").innerHTML = rustyCount;
    });

    var jasonStevensonRef = firebase
      .database()
      .ref("southern-hemisphere-responses/Jason Stevenson");
    jasonStevensonRef.on("value", function(snapshot) {
      var jasonRef = _.size(snapshot.val());
      document.getElementById("JasonStevenson").innerHTML = jasonRef;
    });

    var GrahamSmith = firebase.database().ref("southern-hemisphere-responses/Graham Smith");
    GrahamSmith.on("value", function(snapshot) {
      var GrahamSmithCount = _.size(snapshot.val());
      document.getElementById("GrahamSmith").innerHTML = GrahamSmithCount;
    });

    var HaydenCox = firebase.database().ref("southern-hemisphere-responses/Hayden Cox");
    HaydenCox.on("value", function(snapshot) {
      var HaydenCoxCount = _.size(snapshot.val());
      document.getElementById("HaydenCox").innerHTML = HaydenCoxCount;
    });

    var DarrenHandley = firebase.database().ref("southern-hemisphere-responses/Darren Handley");
    DarrenHandley.on("value", function(snapshot) {
      var DarrenHandleyCount = _.size(snapshot.val());
      document.getElementById("DarrenHandley").innerHTML = DarrenHandleyCount;
    });

    var LeeStacey = firebase.database().ref("southern-hemisphere-responses/Lee Stacey");
    LeeStacey.on("value", function(snapshot) {
      var LeeStaceyCount = _.size(snapshot.val());
      document.getElementById("LeeStacey").innerHTML = LeeStaceyCount;
    });

    var JonPyzel = firebase.database().ref("southern-hemisphere-responses/Jon Pyzel");
    JonPyzel.on("value", function(snapshot) {
      var JonPyzelCount = _.size(snapshot.val());
      document.getElementById("JonPyzel").innerHTML = JonPyzelCount;
    });

    var ChristiaanBradley = firebase
      .database()
      .ref("southern-hemisphere-responses/Christiaan Bradley");
    ChristiaanBradley.on("value", function(snapshot) {
      var ChristiaanBradleyCount = _.size(snapshot.val());
      document.getElementById(
        "ChristiaanBradley"
      ).innerHTML = ChristiaanBradleyCount;
    });

    var JamesCheal = firebase.database().ref("southern-hemisphere-responses/James Cheal");
    JamesCheal.on("value", function(snapshot) {
      var JamesChealCount = _.size(snapshot.val());
      document.getElementById("JamesCheal").innerHTML = JamesChealCount;
    });

    var JohnnyCabianca = firebase.database().ref("southern-hemisphere-responses/JohnnyC");
    JohnnyCabianca.on("value", function(snapshot) {
      var JohnnyCabiancaCount = _.size(snapshot.val());
      document.getElementById("JohnnyCabianca").innerHTML = JohnnyCabiancaCount;
    });

    var SimonAnderson = firebase.database().ref("southern-hemisphere-responses/Simon Anderson");
    SimonAnderson.on("value", function(snapshot) {
      var SimonAndersonCount = _.size(snapshot.val());
      document.getElementById("SimonAnderson").innerHTML = SimonAndersonCount;
    });
  }

  var backButton = document.getElementsByClassName("back-button")[0];
  backButton.onclick = function() {
    var shaperEntries = document.getElementById("shaper-entries");
    shaperEntries.innerHTML = "";

    document.getElementById("shaper").classList.add("d-none");
    document.getElementById("shapers").classList.remove("d-none");
  };
});
</script>


  </body>
</html>
